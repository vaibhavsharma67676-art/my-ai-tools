<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AuraShift - Ultimate Tools</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Space+Grotesk:wght@300;700&family=Inter:wght@400;600&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script>
        tailwind.config = { theme: { extend: { colors: { neonPurple: '#7C3AED', neonCyan: '#06B6D4' }, fontFamily: { heading: ['Space Grotesk'], body: ['Inter'] } } } }
    </script>
    <style>body{background:#050A18;color:white;font-family:'Inter'} .glass{background:rgba(255,255,255,0.03);backdrop-filter:blur(16px);border:1px solid rgba(255,255,255,0.1)}</style>
</head>
<body class="min-h-screen">
    <nav class="flex justify-between p-6 border-b border-white/5">
        <div class="text-3xl font-bold font-heading cursor-pointer" onclick="location.reload()">Aura<span class="text-neonCyan">Shift</span></div>
        <div id="authSection"></div>
    </nav>

    <header class="text-center mt-12 px-4">
        <h1 class="text-5xl font-bold font-heading mb-6">All-in-One AI Tools<br><span class="text-neonCyan">Free & Secure</span></h1>
        <p class="text-gray-400 mb-8">Background Remover â€¢ PDF Tools â€¢ Image Resizer</p>
    </header>

    <section id="tools" class="p-6 py-10 max-w-7xl mx-auto grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6">
        
        <div class="glass p-6 rounded-2xl cursor-pointer hover:border-neonPurple transition" onclick="openTool('BG Remover', '/api/remove-bg', 'image')">
            <i class="fa-solid fa-eraser text-neonPurple text-3xl mb-4"></i>
            <h3 class="text-xl font-bold">BG Remover</h3>
            <p class="text-sm text-gray-400">Remove background instantly.</p>
        </div>

        <div class="glass p-6 rounded-2xl cursor-pointer hover:border-red-500 transition" onclick="openTool('Image to PDF', '/api/img-to-pdf', 'image')">
            <i class="fa-solid fa-file-pdf text-red-500 text-3xl mb-4"></i>
            <h3 class="text-xl font-bold">Image to PDF</h3>
            <p class="text-sm text-gray-400">Convert Photo to PDF.</p>
        </div>

        <div class="glass p-6 rounded-2xl cursor-pointer hover:border-yellow-500 transition" onclick="openTool('PDF Merger', '/api/merge-pdf', 'pdf-multi')">
            <i class="fa-solid fa-layer-group text-yellow-500 text-3xl mb-4"></i>
            <h3 class="text-xl font-bold">PDF Merger</h3>
            <p class="text-sm text-gray-400">Join multiple PDFs into one.</p>
        </div>

        <div class="glass p-6 rounded-2xl cursor-pointer hover:border-green-500 transition" onclick="openTool('Image Resizer', '/api/resize-image', 'resize')">
            <i class="fa-solid fa-compress text-green-500 text-3xl mb-4"></i>
            <h3 class="text-xl font-bold">Resize in KB</h3>
            <p class="text-sm text-gray-400">Compress image to fixed size.</p>
        </div>

    </section>

    <div id="toolOverlay" class="fixed inset-0 bg-black/90 hidden z-50 flex items-center justify-center p-4">
        <div class="glass w-full max-w-4xl p-8 rounded-3xl relative">
            <button onclick="document.getElementById('toolOverlay').classList.add('hidden')" class="absolute top-4 right-4 text-gray-400"><i class="fa-solid fa-xmark text-2xl"></i></button>
            <h2 id="toolTitle" class="text-3xl font-heading font-bold mb-6 text-neonCyan">Tool Name</h2>
            
            <div class="flex flex-col md:flex-row gap-8">
                <div class="flex-1">
                    <input type="file" id="fileInput" class="block w-full text-sm text-gray-400 file:mr-4 file:py-2 file:px-4 file:rounded-full file:border-0 file:bg-neonPurple file:text-white hover:file:bg-purple-600 cursor-pointer bg-white/5 rounded-lg border border-gray-600 p-2 mb-4">
                    
                    <div id="resizeOptions" class="hidden mb-4">
                        <label class="text-gray-400 text-sm">Target Size (KB):</label>
                        <input type="number" id="kbInput" value="50" class="w-full bg-black/50 border border-gray-600 rounded p-2 text-white mt-1">
                    </div>

                    <button onclick="processAI()" id="btnText" class="w-full bg-neonCyan text-black font-bold py-3 rounded-xl">Start Processing ðŸš€</button>
                </div>
                <div id="resultContent" class="flex-1 bg-black/30 rounded-xl p-4 flex items-center justify-center min-h-[250px] text-gray-500">Result appears here</div>
            </div>
        </div>
    </div>

    <script>
        let isLoggedIn = {{ 'true' if user.is_authenticated else 'false' }};
        let currentUser = "{{ user.username if user.is_authenticated else '' }}";
        let isLoginMode = true;
        let currentEndpoint = '';
        let currentType = '';

        function updateNav() {
            document.getElementById('authSection').innerHTML = isLoggedIn 
                ? `<span class="text-neonCyan font-bold mr-4">Hi, ${currentUser}</span><button onclick="window.location.href='/logout'" class="text-red-400 border border-red-400/30 px-4 py-1 rounded-full">Logout</button>`
                : `<button onclick="document.getElementById('authModal').classList.remove('hidden')" class="bg-white/10 px-6 py-2 rounded-full">Login / Signup</button>`;
        }
        updateNav();

        // AUTH LOGIC
        async function submitAuth() {
            const u = document.getElementById('username').value, p = document.getElementById('password').value;
            const res = await fetch(isLoginMode ? '/login' : '/signup', { method: 'POST', headers: {'Content-Type': 'application/json'}, body: JSON.stringify({username: u, password: p}) });
            const data = await res.json();
            if(data.success) { isLoginMode ? location.reload() : (alert("Created! Login now."), toggleAuth()); } else { alert(data.message); }
        }
        function toggleAuth() { isLoginMode = !isLoginMode; document.getElementById('authTitle').innerText = isLoginMode ? "Login" : "Signup"; }

        // TOOL LOGIC
        function openTool(name, endpoint, type) {
            if(!isLoggedIn) return document.getElementById('authModal').classList.remove('hidden');
            currentEndpoint = endpoint;
            currentType = type;
            
            document.getElementById('toolTitle').innerText = name;
            document.getElementById('toolOverlay').classList.remove('hidden');
            document.getElementById('resultContent').innerHTML = "Result appears here";
            
            const fi = document.getElementById('fileInput');
            fi.value = "";
            
            // Logic for Inputs
            if (type === 'pdf-multi') {
                fi.setAttribute('multiple', '');
                fi.accept = ".pdf";
            } else {
                fi.removeAttribute('multiple');
                fi.accept = "image/*";
            }
            
            // Logic for Resize Option
            if (type === 'resize') {
                document.getElementById('resizeOptions').classList.remove('hidden');
            } else {
                document.getElementById('resizeOptions').classList.add('hidden');
            }
        }

        async function processAI() {
            const fi = document.getElementById('fileInput');
            if(!fi.files.length) return alert("Select file!");
            
            document.getElementById('btnText').innerText = "Processing...";
            const fd = new FormData();
            
            if (currentType === 'pdf-multi') {
                for (let i = 0; i < fi.files.length; i++) { fd.append('file', fi.files[i]); }
            } else {
                fd.append('file', fi.files[0]);
            }

            if (currentType === 'resize') {
                fd.append('kb', document.getElementById('kbInput').value);
            }

            try {
                const res = await fetch(currentEndpoint, { method: 'POST', body: fd });
                if(res.ok) {
                    const blob = await res.blob();
                    const url = URL.createObjectURL(blob);
                    
                    let downloadName = "result.png";
                    if (currentType === 'image') downloadName = "converted.pdf"; 
                    if (currentType === 'pdf-multi') downloadName = "merged.pdf";
                    if (currentType === 'resize') downloadName = "resized.jpg";

                    document.getElementById('resultContent').innerHTML = `
                        <div class="text-center">
                            <i class="fa-solid fa-circle-check text-green-500 text-5xl mb-4"></i>
                            <p class="text-white mb-4">Task Completed!</p>
                            <a href="${url}" download="${downloadName}" class="bg-neonCyan text-black px-6 py-2 rounded-full font-bold">Download File</a>
                        </div>`;
                } else { alert("Error from server"); }
            } catch(e) { alert("Failed"); } 
            finally { document.getElementById('btnText').innerText = "Start Processing ðŸš€"; }
        }
    </script>
    
    <div id="authModal" class="fixed inset-0 bg-black/90 hidden z-50 flex items-center justify-center p-4">
        <div class="glass w-full max-w-md p-8 rounded-2xl relative">
            <button onclick="document.getElementById('authModal').classList.add('hidden')" class="absolute top-4 right-4 text-gray-400"><i class="fa-solid fa-xmark"></i></button>
            <h2 id="authTitle" class="text-2xl font-bold mb-6 text-center">Login</h2>
            <input type="text" id="username" placeholder="Username" class="w-full bg-black/50 border border-gray-700 rounded-lg p-3 mb-4 text-white">
            <input type="password" id="password" placeholder="Password" class="w-full bg-black/50 border border-gray-700 rounded-lg p-3 mb-6 text-white">
            <button onclick="submitAuth()" class="w-full bg-neonCyan text-black font-bold py-3 rounded-lg">Submit</button>
            <p class="text-center mt-4 text-gray-400 cursor-pointer" onclick="toggleAuth()">New here? Create Account</p>
        </div>
    </div>
</body>
</html>